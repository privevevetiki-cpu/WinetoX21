-- LocalScript в StarterGui
local player = game.Players.LocalPlayer

-- УДАЛЕНИЕ ПРЕДЫДУЩЕГО GUI, если уже есть
local oldGui = player:WaitForChild("PlayerGui"):FindFirstChild("LuaGUI")
if oldGui then
    oldGui:Destroy()
end

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- === GUI ===
local gui = Instance.new("ScreenGui")
gui.Name = "LuaGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- === ИКОНКА ===
local iconSize = 60
local icon = Instance.new("Frame")
icon.Size = UDim2.new(0, iconSize, 0, iconSize)
icon.Position = UDim2.new(0.1, 0, 0.8, 0)
icon.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
icon.BackgroundTransparency = 0.4
icon.BorderSizePixel = 0
icon.Parent = gui

local iconCorner = Instance.new("UICorner")
iconCorner.CornerRadius = UDim.new(1, 0)
iconCorner.Parent = icon

local iconStroke = Instance.new("UIStroke")
iconStroke.Thickness = 2
iconStroke.Transparency = 0.5
iconStroke.Color = Color3.fromRGB(255, 255, 255)
iconStroke.Parent = icon

local iconText = Instance.new("TextLabel")
iconText.Size = UDim2.new(1, 0, 1, 0)
iconText.BackgroundTransparency = 1
iconText.Text = "Lua"
iconText.TextScaled = true
iconText.Font = Enum.Font.Arcade
iconText.TextColor3 = Color3.fromRGB(255, 255, 255)
iconText.Parent = icon

-- === ОКНО ===
local window = Instance.new("Frame")
window.Size = UDim2.new(0, 230, 0, 300)
window.Position = UDim2.new(0.5, 0, 0.5, 0)
window.AnchorPoint = Vector2.new(0.5, 0.5)
window.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
window.BackgroundTransparency = 0.15
window.Visible = false
window.Parent = gui

local winCorner = Instance.new("UICorner")
winCorner.CornerRadius = UDim.new(0.05, 0)
winCorner.Parent = window

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "Lua Menu"
title.Font = Enum.Font.Arcade
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = window

-- Контейнер для кнопок
local buttonsFrame = Instance.new("Frame")
buttonsFrame.Size = UDim2.new(1, 0, 1, -40)
buttonsFrame.Position = UDim2.new(0, 0, 0, 40)
buttonsFrame.BackgroundTransparency = 1
buttonsFrame.Parent = window

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0, 6)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top
layout.Parent = buttonsFrame

-- === Создание кнопок ===
local buttons = {}
local buttonNames = {
    "HitBox Visible",
    "Speed Booster",
    "Big Ragdoll",
    "Near Player",
    "Button 5",
    "Button 6",
    "Button 7",
    "Button 8",
    "Button 9"
}

local function createButton(name)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.85, 0, 0, 25)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextScaled = true
    btn.Font = Enum.Font.Arcade
    btn.Text = name
    btn.Parent = buttonsFrame

    local bc = Instance.new("UICorner")
    bc.CornerRadius = UDim.new(0.2, 0)
    bc.Parent = btn

    -- Плавная смена цвета при наведении
    local function tweenColor(color)
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = color}):Play()
    end

    btn.MouseEnter:Connect(function() tweenColor(Color3.fromRGB(70,70,70)) end)
    btn.MouseLeave:Connect(function() tweenColor(Color3.fromRGB(40,40,40)) end)

    buttons[name] = btn
end

for _, name in ipairs(buttonNames) do
    createButton(name)
end

-- === HITBOX Visible через блоки + ник ===
do
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    local hitboxVisible = false

    local function createHitboxESP(char, player)
        local hitbox = char:FindFirstChild("__HITBOX")
        if hitbox and hitbox:IsA("BasePart") then
            -- Highlight
            local hl = hitbox:FindFirstChild("HitboxHighlight")
            if not hl then
                hl = Instance.new("Highlight")
                hl.Name = "HitboxHighlight"
				hitbox.Transparency = 0.8
                hl.FillColor = Color3.fromRGB(0, 0, 0)
                hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                hl.FillTransparency = 0.5
                hl.OutlineTransparency = 0
                hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                hl.Parent = hitbox
            end

            -- BillboardGui с ником
            if not hitbox:FindFirstChild("BillboardGui") then
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "BillboardGui"
                billboard.Adornee = hitbox
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 20)
                billboard.StudsOffset = Vector3.new(0, 2.5, 0)
                billboard.Parent = hitbox

                local nameLabel = Instance.new("TextLabel")
                nameLabel.Size = UDim2.new(1, 0, 1, 0)
                nameLabel.BackgroundTransparency = 0.4
                nameLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                nameLabel.Text = player.DisplayName or player.Name
                nameLabel.Font = Enum.Font.Arcade
                nameLabel.TextSize = 14
                nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                nameLabel.TextStrokeTransparency = 0.2
                nameLabel.Parent = billboard
            end
        end
    end

    local function updateHitboxes()
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character then
                local hitbox = plr.Character:FindFirstChild("__HITBOX")
                if hitbox then
                    if hitboxVisible then
                        createHitboxESP(plr.Character, plr)
                    else
                        for _, v in ipairs(hitbox:GetChildren()) do
                            if v:IsA("Highlight") or v:IsA("BillboardGui") then
                                v:Destroy()
                            end
                        end
                    end
                end
            end
        end
    end

    -- Кнопка для включения / выключения
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 140, 0, 28)
    toggleButton.Text = "HitBox Visible"
    toggleButton.Font = Enum.Font.Arcade
    toggleButton.TextSize = 16
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleButton.BackgroundColor3 = Color3.fromRGB(220, 20, 60)
    toggleButton.AutoButtonColor = false
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = toggleButton
    toggleButton.Parent = mainFrame

    toggleButton.MouseButton1Click:Connect(function()
        hitboxVisible = not hitboxVisible
        updateHitboxes()
        toggleButton.BackgroundColor3 = hitboxVisible and Color3.fromRGB(0,170,0) or Color3.fromRGB(220,20,60)
    end)

    -- Автообновление при заходе/респавне
    Players.PlayerAdded:Connect(function(plr)
        plr.CharacterAdded:Connect(function()
            task.wait(1)
            updateHitboxes()
        end)
    end)

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            createHitboxESP(plr.Character, plr)
        end
    end
end

-- === Speed Booster логика ===
local speedButton = buttons["Speed Booster"]
do
    local speedConn
    local baseSpeed = 27
    local active = false

    local function GetCharacter()
        local Char = player.Character or player.CharacterAdded:Wait()
        local HRP = Char:WaitForChild("HumanoidRootPart")
        local Hum = Char:FindFirstChildOfClass("Humanoid")
        return Char, HRP, Hum
    end

    local function getMovementInput()
        local Char, HRP, Hum = GetCharacter()
        if not Char or not HRP or not Hum then return Vector3.new(0,0,0) end
        local moveVector = Hum.MoveDirection
        if moveVector.Magnitude > 0.1 then
            return Vector3.new(moveVector.X, 0, moveVector.Z).Unit
        end
        return Vector3.new(0,0,0)
    end

    local function startSpeedControl()
        if speedConn then return end
        speedConn = RunService.Heartbeat:Connect(function()
            local Char, HRP, Hum = GetCharacter()
            if not Char or not HRP or not Hum then return end
            local inputDirection = getMovementInput()
            if inputDirection.Magnitude > 0 then
                HRP.AssemblyLinearVelocity = Vector3.new(
                    inputDirection.X*baseSpeed,
                    HRP.AssemblyLinearVelocity.Y,
                    inputDirection.Z*baseSpeed
                )
            else
                HRP.AssemblyLinearVelocity = Vector3.new(0, HRP.AssemblyLinearVelocity.Y, 0)
            end
        end)
    end

    local function stopSpeedControl()
        if speedConn then speedConn:Disconnect() speedConn = nil end
        local Char, HRP = GetCharacter()
        if HRP then HRP.AssemblyLinearVelocity = Vector3.new(0, HRP.AssemblyLinearVelocity.Y, 0) end
    end

    speedButton.MouseButton1Click:Connect(function()
        active = not active
        if active then
            startSpeedControl()
            TweenService:Create(speedButton, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(0,170,0)}):Play()
        else
            stopSpeedControl()
            TweenService:Create(speedButton, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(220,20,60)}):Play()
        end
    end)

    -- Начальный цвет кнопки
    speedButton.BackgroundColor3 = Color3.fromRGB(220,20,60)
end

-- === Перетаскивание иконки ===
local dragging = false
local dragStart, startPos

icon.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = icon.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        icon.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- === Открытие/Закрытие окна ===
local function toggleWindow()
    if window.Visible then
        window:TweenSizeAndPosition(
            UDim2.new(0, 0, 0, 0),
            window.Position,
            Enum.EasingDirection.In,
            Enum.EasingStyle.Quint,
            0.2,
            true
        )
        task.wait(0.2)
        window.Visible = false
    else
        window.Visible = true
        window.Size = UDim2.new(0, 0, 0, 0)
        window:TweenSizeAndPosition(
            UDim2.new(0, 230, 0, 300),
            UDim2.new(0.5,0,0.5,0),
            Enum.EasingDirection.Out,
            Enum.EasingStyle.Quint,
            0.25,
            true
        )
    end
end

icon.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and not dragging then
        toggleWindow()
    end
end)

-- Открытие/закрытие по клавише RightShift
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.RightShift then
        toggleWindow()
    end
end)
-- === Big Ragdoll логика ===
local bigRagdollButton = buttons["Big Ragdoll"]

do
    local enabled = false
    local Player = game.Players.LocalPlayer
    local Mouse = Player:GetMouse()
    local TweenService = game:GetService("TweenService")

    -- Функция удара
    local function performRagdollHit()
        local character = Player.Character
        if not character then return end

        local backpack = Player:WaitForChild("Backpack")

        local bat = backpack:FindFirstChild("Bat") or character:FindFirstChild("Bat")
        local glitch = backpack:FindFirstChild("Glitched Slap") or character:FindFirstChild("Glitched Slap")

        if not bat or not glitch then return end

        -- Переключение Bat → Glitched Slap
        if bat.Parent == character then
            bat.Parent = backpack
        end
        
        glitch.Parent = character

        -- Вызов удара
        if glitch:FindFirstChild("Activate") then
            glitch.Activate:Fire()
        else
            glitch:Activate()
        end

        -- Возврат через 0.1 сек
        task.delay(0.001, function()
            if glitch.Parent == character then
                glitch.Parent = backpack
            end
            bat.Parent = character
        end)
    end

    -- Кнопка включения режима
    bigRagdollButton.MouseButton1Click:Connect(function()
        enabled = not enabled
        
        TweenService:Create(
            bigRagdollButton,
            TweenInfo.new(0.15),
            {BackgroundColor3 = enabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(220,20,60)}
        ):Play()
    end)

    -- Удар по клику мыши
    Mouse.Button1Down:Connect(function()
        if enabled then
            performRagdollHit()
        end
    end)
end
-- === Near Player (по линии взгляда, 1 удар/сек) ===
local nearPlayerButton = buttons["Near Player"]

do
    local enabled = false
    local Player = game.Players.LocalPlayer
    local RunService = game:GetService("RunService")
    local TweenService = game:GetService("TweenService")
    local Players = game:GetService("Players")

    local lastHitTime = 0 -- время последнего удара

    -- Переключение кнопки
    nearPlayerButton.MouseButton1Click:Connect(function()
        enabled = not enabled
        TweenService:Create(
            nearPlayerButton,
            TweenInfo.new(0.15),
            {BackgroundColor3 = enabled and Color3.fromRGB(0,170,0) or Color3.fromRGB(220,20,60)}
        ):Play()
    end)

    -- Функция удара Glitched Slap
    local function hitNearbyPlayer(target)
        local currentTime = tick()
        if currentTime - lastHitTime < 1 then return end -- 1 сек задержка
        lastHitTime = currentTime

        local character = Player.Character
        if not character or not target.Character then return end

        local backpack = Player:WaitForChild("Backpack")
        local bat = backpack:FindFirstChild("Bat") or character:FindFirstChild("Bat")
        local glitch = backpack:FindFirstChild("Glitched Slap") or character:FindFirstChild("Glitched Slap")
        if not bat or not glitch then return end

        if bat.Parent == character then bat.Parent = backpack end
        glitch.Parent = character

        if glitch:FindFirstChild("Activate") then
            glitch.Activate:Fire()
        else
            glitch:Activate()
        end

        task.delay(0.001, function()
            if glitch.Parent == character then glitch.Parent = backpack end
            bat.Parent = character
        end)
    end

    -- Проверка игроков в поле зрения
    RunService.Heartbeat:Connect(function()
        if enabled then
            local char = Player.Character
            if not char then return end
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local head = char:FindFirstChild("Head")
            if not hrp or not head then return end

            local lookDir = head.CFrame.LookVector -- направление взгляда
            local origin = hrp.Position

            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= Player and plr.Character then
                    local targetHRP = plr.Character:FindFirstChild("HumanoidRootPart")
                    if targetHRP then
                        local toTarget = targetHRP.Position - origin
                        local distance = toTarget.Magnitude
                        if distance <= 8 then
                            -- угол между взглядом и направлением до цели
                            local angle = math.acos(lookDir:Dot(toTarget.Unit))
                            if angle <= math.rad(45) then -- 45° впереди
                                hitNearbyPlayer(plr)
                            end
                        end
                    end
                end
            end
        end
    end)
end
